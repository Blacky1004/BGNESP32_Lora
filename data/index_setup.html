<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css" />
    <title>LoRa ESP32</title>
    
</head>
<body>
    <nav class="navbar navbar-expand navbar-light bg-light">
        <div class="container px-5">
            <a class="navbar-brand" href="javascript:void(0)">Setup %CHIPID%</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="javascript:void(0)" id="lnkHome" onclick="showDasboard()">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" id="lnkConnections" onclick="showConnections()">Verbindungen</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" id="lnkSensors" onclick="showSensors()">Sensoren</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 align-items-center my-5">
            <div class="col-lg-4">
                <img class="img-fluid rounded mb-4 mb-lg-0" src="logo-buergernetzgeragreiz.png" alt="logo">
            </div>
            <div class="col-lg-8">
                <h1 class="font-weight-light">Bürgernetz Gera-Greiz Feinstaubsensor</h1>
                <p>Hier ne kurze Einführung etc. zum Projekt und wo man sich z.B. bei Problemen hinwenden kann.</p>
            </div>
        </div>
        <div class="card text-white bg-bnetz my-5 py-4 text-center">
            <div class="card-body">
                <p class="text-white m-0">
                    Wichtige Hinweise zu den untenstehenden Einstellungen
                </p>
            </div>
        </div>
        <div class="row gx-4 gx-lg-5" id="pDashboerd">
            <div class="col-md-6 mb-5">
                <div class="card h-100" id="wlansetup">
                    <div class="card-body">
                        <h3 class="card-title">WLAN Einstellungen</h3>
                        <p class="card-text">
                            Möchten Sie auf diesem System Internet über WLAN verenden, weil bspw. kein LoRaWAN zur Verfügung steht, oder
                            Sie dieses System über Remote steuern, so geben Sie bitte hier die entsprechenden Daten für ihren Router ein.
                            Natürlich können Sie auch, wenn verfügbar, Freifunk als WLAN verwenden.
                        </p>
                        <div class="mb-3">
                            <input type="checkbox" class="form-check-input" id="enableWlan" name="enableWlan" checked/>
                            <label for="enableWlan">WLAN aktivieren</label>
                        </div>
                        <div class="mb-3">
                            <label>SSID</label>
                            <select class="form-control" id="ssid" name="ssid">
                            </select>
                        </div>
                        <div class="mb-4">
                            <label>WLAN Passwort</label>
                            <input type="password" class="form-control" id="ssidpasw" name="ssidpasw" />
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="mt-4 mt-md-0 ms-auto">
                            <button onclick="checkwifi()" class="btn btn-primary font-weight-medium rounded-pill px-4">Speichern</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-5" >
                <div class="card h-100" id="loraSetup">
                    <form>
                        <div class="card-body">
                            <h3 class="card-title">LoRaWAN Einstellungen</h3>
                            <p class="card-text" id="ltitle"></p>
                            <div class="mb-3">
                                <input type="checkbox" class="form-check-input" id="useLora" name="useLora" checked/>
                                <label for="useLora">LoRaWAN verwenden</label>
                            </div>
                            <div class="mb-3">
                                <label for="nwkskey">NwkSKey</label>
                                <input type="text" class="form-control" id="nwkskey" name="nwkskey" placeholder="00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00"/>
                            </div>
                            <div class="mb-3">
                                <label for="appskey">AppSKey</label>
                                <input type="text" class="form-control" id="appskey" name="appskey" placeholder="00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00"/>
                            </div>
                            <div class="mb-3">
                                <label for="devaddr">DevAddr</label>
                                <input type="text" class="form-control" id="devaddr" name="devaddr" placeholder="00 00 00 00"/>
                            </div>
                            <div class="mb-3">
                                <p>Sollte der Gateyway ein Single-Gateway sein, so ist hier nur der festeingestellte Kanal 1 zu verwenden.
                                    Die übrigen Kanäle sind zu deaktivieren.
                                </p>
                                <div class="row">
                                    <div class="col-md-3">
                                        <input type="checkbox" id="channel1" class="form-check-input" disabled checked/>
                                        <label>Kanal 1</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 2</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 3</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 4</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 5</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 6</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 7</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="checkbox" class="form-check-input"  checked/>
                                        <label>Kanal 8</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="mt-3 mt-md-0 ms-auto">
                                <button class="btn btn-primary font-weight-medium rounded-pill px-4">Speichern</button>
                            </div>
                        </div>
                    </form>
                </div>                
            </div>
        </div>
        <div class="row gx-4 gx-lg-5" id="pConnections">

        </div>
        <div class="row gx-4 gx-lg-5" id="pSensors">

        </div>
    </div>
    <footer class="py-5 footer-light">

    </footer>
    <script>
        
        var loraAvailable = true;//%LORAAVAILABLE%;
        var useLora = false;
        var loraText = 'LoraWAN steht für deinen Standort leider nicht zur Verfügung bzw. ist die Abdeckung nicht aussreichend.';
        document.addEventListener("DOMContentLoaded", () => {
            //Beim start immer die DashbordDiv aktivieren, den rest disablen
            showDasboard();
            if(!loraAvailable){
                document.getElementById("ltitle").innerHTML = loraText;
                var loraNodes = document.getElementById('loraSetup').getElementsByTagName('*');
                for(var i = 0; i < loraNodes.length; i++){
                    loraNodes[i].disabled = true;
                }
                document.getElementById("useLora").checked = true;
            }
            else {
                loraText = "Bei Unsicherheit bei diesen Einstellungen wende dich bitte an die Mitglieder des Bürgernetz Gera-Greiz e.V";
                document.getElementById("ltitle").innerHTML = loraText;
                var loraNodes = document.getElementById('loraSetup').getElementsByTagName('*');
                for(var i = 0; i < loraNodes.length; i++){
                    loraNodes[i].disabled = false;
                }
                document.getElementById("channel1").disabled = true;
            }
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if(this.readyState == 4 && this.status == 200){
                    let wifilist = '<option value="null">-- Auswahl --</option>';
                    console.log(this.responseText);
                    var datas = JSON.parse(this.responseText);
                    for(var i= 0; i < datas.length; i++){
                        wifilist += '<option value="' + datas[i]["ssid"]+'">'+datas[i]["ssid"]+"</option>";
                    }
                    document.getElementById('ssid').innerHTML = wifilist;
                }
            };
            xhttp.open("GET", "/scan_wifi", true);
            xhttp.send();

        });
        document.getElementById("enableWlan").addEventListener('click', function(e){
            var wlanNodes = document.getElementById("wlansetup").getElementsByTagName("*");
            for(var i = 0; i < wlanNodes.length; i++) {
                if(document.getElementById("enableWlan").checked){
                    wlanNodes[i].disabled = false;
                }
                else {
                    wlanNodes[i].disabled = true;
                    document.getElementById("enableWlan").disabled = false;
                }
            }
        });
        document.getElementById("useLora").addEventListener('click', function(e) {
            var loraNodes = document.getElementById('loraSetup').getElementsByTagName('*');
                for(var i = 0; i < loraNodes.length; i++){
                    if(document.getElementById("useLora").checked) {
                        loraNodes[i].disabled = false;
                    }
                    else {
                        loraNodes[i].disabled = true;
                        document.getElementById("useLora").disabled = false;
                    }                    
                }
                document.getElementById("channel1").disabled = true;
                
        });
        function checkwifi(){
            let ssid = document.getElementById("ssid").vaue;
            let pasw = document.getElementById("ssidpasw").value;
            let json = {
                ssid: ssid,
                pasw: pasw
            };
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                console.log(this.responseText);
            }
            xhttp.open("POST","/test_wifi", true);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.send(json);
        }
        function showConnections(){
            document.getElementById("pDashboerd").style.display = "none"
            document.getElementById("pConnections").style.display = "flex"
            document.getElementById("pSensors").style.display = "none"
        }
        function showSensors() {
            document.getElementById("pDashboerd").style.display = "none"
            document.getElementById("pConnections").style.display = "none"
            document.getElementById("pSensors").style.display = "flex"           
        }
        function showDasboard(){
            document.getElementById("pDashboerd").style.display = "flex"
            document.getElementById("pConnections").style.display = "none"
            document.getElementById("pSensors").style.display = "none"
        }
    </script>
    <div class="modal" id="systemRestart">
        <div class="modal-content">
            
        </div>
    </div>
</body>
</html>